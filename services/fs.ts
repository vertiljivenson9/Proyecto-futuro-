const DB_NAME='VertilFS_v2';const STORE='inodes';let db=null;export const initFS=()=>new Promise(r=>{const req=indexedDB.open(DB_NAME,3);req.onupgradeneeded=e=>e.target.result.createObjectStore(STORE,{keyPath:'path'});req.onsuccess=e=>{db=e.target.result;r();};});export const saveFile=async(p,c,n)=>{const tx=db.transaction(STORE,'readwrite');tx.objectStore(STORE).put({path:p,content:c,namespace:n,size:c.length,type:'file'});};export const listDir=async p=>new Promise(r=>{const req=db.transaction(STORE,'readonly').objectStore(STORE).getAll();req.onsuccess=()=>r(req.result.filter(i=>(i.path.substring(0,i.path.lastIndexOf('/'))||'/')===p));});export const getInode=p=>new Promise(r=>{const req=db.transaction(STORE,'readonly').objectStore(STORE).get(p);req.onsuccess=()=>r(req.result);});export const deleteInode=p=>new Promise(r=>{const tx=db.transaction(STORE,'readwrite');tx.objectStore(STORE).delete(p);tx.oncomplete=()=>r();});