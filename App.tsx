import React,{useState,useEffect,useCallback,useRef} from 'react';import Desktop from './components/Desktop';import Login from './components/Login';import {initFS} from './services/fs';import {initRegistry,getRegistry} from './services/registry';import {initAssets} from './services/assets';import {Kernel} from './services/kernel';const App=()=>{const [bootState,setBootState]=useState('bios');const [windows,setWindows]=useState([]);const [registry,setRegistry]=useState(null);const bootInitiated=useRef(false);useEffect(()=>{if(bootInitiated.current)return;bootInitiated.current=true;initFS().then(()=>initRegistry()).then(reg=>{setRegistry(reg);initAssets();Kernel.checkSecurityStatus().then(locked=>{setTimeout(()=>{const loader=document.getElementById('system-loader');if(loader)loader.style.display='none';setBootState(locked?'login':'desktop');},2000);});});},[]);const openWindow=useCallback((appId,title,icon,path)=>{setWindows(prev=>{const exist=prev.find(w=>w.appId===appId);if(exist)return prev.map(w=>w.appId===appId?{...w,isMinimized:false,zIndex:999}:w);return [...prev,{id:crypto.randomUUID(),title,icon,isOpen:true,zIndex:100,appId,initialPath:path,x:50,y:50,width:900,height:600}];});},[]);if(bootState==='bios')return <div className="h-full bg-black flex items-center justify-center font-mono text-indigo-500">BOOTING SOVEREIGN KERNEL...</div>;if(bootState==='login')return <Login onUnlock={p=>Kernel.verifyPin(p)} onFileUnlock={c=>Kernel.verifyKeyFile(c)}/>;return <Desktop registry={registry} windows={windows} setWindows={setWindows} onOpenWindow={openWindow} onPower={()=>window.location.reload()}/>;};export default App;